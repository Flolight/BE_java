<!DOCTYPE html><!-- Page generated by OCaml with Ocsigen.
See http://ocsigen.org/ and http://caml.inria.fr/ for information -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>BinaryHeap.java</title><meta content="text/html; charset=utf-8" http-equiv="content-type" /><meta content="Supports pÃ©dagogiques" name="description" /><link media="all" style="text/css" href="../../../common.css" rel="stylesheet" /><link media="all" style="text/css" href="../../../gr.css" rel="stylesheet" /><script src="../../../foldable.js"></script></head><body><div class="main"><h1>BinaryHeap.java</h1><div class="progpage"><div class="prog"><pre><span class="comment">//
</span><span class="comment">// ******************PUBLIC OPERATIONS*********************
</span><span class="comment">// void insert( x )       --&gt; Insert x
</span><span class="comment">// Comparable deleteMin( )--&gt; Return and remove smallest item
</span><span class="comment">// Comparable findMin( )  --&gt; Return smallest item
</span><span class="comment">// boolean isEmpty( )     --&gt; Return true if empty; else false
</span><span class="comment">// ******************ERRORS********************************
</span><span class="comment">// Throws RuntimeException for findMin and deleteMin when empty
</span>
<span class="kw">import</span> <span class="ident">java</span>.<span class="ident">util</span>.* ;

<span class="comment">/**
 * Implements a binary heap.
 * Note that all &quot;matching&quot; is based on the compareTo method.
 * @author Mark Allen Weiss
 * @author DLB
 */</span>
<span class="kw">public</span> <span class="kw">class</span> <span class="type">BinaryHeap</span>&lt;<span class="type">E</span> <span class="kw">extends</span> <span class="type">Comparable</span>&lt;<span class="type">E</span>&gt;&gt; {

    <span class="kw">private</span> <span class="kw">int</span> <span class="ident">currentSize</span>; <span class="comment">// Number of elements in heap
</span>
    <span class="comment">// Java genericity does not work with arrays.
</span>    <span class="comment">// We have to use an ArrayList
</span>    <span class="kw">private</span> <span class="type">ArrayList</span>&lt;<span class="type">E</span>&gt; <span class="ident">array</span>; <span class="comment">// The heap array
</span>
    <span class="comment">/**
     * Construct the binary heap.
     */</span>
    <span class="kw">public</span> <span class="type">BinaryHeap</span>() {
        <span class="kw">this</span>.<span class="ident">currentSize</span> = <span class="number">0</span>;
        <span class="kw">this</span>.<span class="ident">array</span> = <span class="kw">new</span> <span class="type">ArrayList</span>&lt;<span class="type">E</span>&gt;() ;
    }

    <span class="comment">// Constructor used for debug.
</span>    <span class="kw">private</span> <span class="type">BinaryHeap</span>(<span class="type">BinaryHeap</span>&lt;<span class="type">E</span>&gt; <span class="ident">heap</span>) {
	<span class="kw">this</span>.<span class="ident">currentSize</span> = <span class="ident">heap</span>.<span class="ident">currentSize</span> ;
	<span class="kw">this</span>.<span class="ident">array</span> = <span class="kw">new</span> <span class="type">ArrayList</span>&lt;<span class="type">E</span>&gt;(<span class="ident">heap</span>.<span class="ident">array</span>) ;
    }

    <span class="comment">// Sets an element in the array
</span>    <span class="kw">private</span> <span class="kw">void</span> <span class="ident">arraySet</span>(<span class="kw">int</span> <span class="ident">index</span>, <span class="type">E</span> <span class="ident">value</span>) {
	<span class="kw">if</span> (<span class="ident">index</span> == <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">size</span>()) {
	    <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">add</span>(<span class="ident">value</span>) ;
	}
	<span class="kw">else</span> {
	    <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">set</span>(<span class="ident">index</span>, <span class="ident">value</span>) ;
	}
    }

    <span class="comment">/**
     * Test if the heap is logically empty.
     * @return true if empty, false otherwise.
     */</span>
    <span class="kw">public</span> <span class="kw">boolean</span> <span class="ident">isEmpty</span>() { <span class="kw">return</span> <span class="kw">this</span>.<span class="ident">currentSize</span> == <span class="number">0</span>; }
    
    <span class="comment">/**
     * Returns size.
     * @return current size.
     */</span>
    <span class="kw">public</span> <span class="kw">int</span> <span class="ident">size</span>() { <span class="kw">return</span> <span class="kw">this</span>.<span class="ident">currentSize</span>; }
        
    
    <span class="comment">/**
     * Returns index of parent.
     */</span>
    <span class="kw">private</span> <span class="kw">int</span> <span class="ident">index_parent</span>(<span class="kw">int</span> <span class="ident">index</span>) {
	<span class="kw">return</span> (<span class="ident">index</span> - <span class="number">1</span>) / <span class="number">2</span> ;
    }

    <span class="comment">/**
     * Returns index of left child.
     */</span>
    <span class="kw">private</span> <span class="kw">int</span> <span class="ident">index_left</span>(<span class="kw">int</span> <span class="ident">index</span>) {
	<span class="kw">return</span> <span class="ident">index</span> * <span class="number">2</span> + <span class="number">1</span> ;
    }

    <span class="comment">/**
     * Insert into the heap.
     * @param x the item to insert.
     */</span>
    <span class="kw">public</span> <span class="kw">void</span> <span class="ident">insert</span>(<span class="type">E</span> <span class="ident">x</span>) {
	<span class="kw">int</span> <span class="ident">index</span> = <span class="kw">this</span>.<span class="ident">currentSize</span>++ ;
	<span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">index</span>, <span class="ident">x</span>) ;
	<span class="kw">this</span>.<span class="ident">percolateUp</span>(<span class="ident">index</span>) ;
    }

    <span class="comment">/**
     * Internal method to percolate up in the heap.
     * @param index the index at which the percolate begins.
     */</span>
    <span class="kw">private</span> <span class="kw">void</span> <span class="ident">percolateUp</span>(<span class="kw">int</span> <span class="ident">index</span>) {
	<span class="type">E</span> <span class="ident">x</span> = <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">index</span>) ;

        <span class="kw">for</span>( ; <span class="ident">index</span> &gt; <span class="number">0</span> &amp;&amp; <span class="ident">x</span>.<span class="ident">compareTo</span>(<span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">index_parent</span>(<span class="ident">index</span>)) ) &lt; <span class="number">0</span>; <span class="ident">index</span> = <span class="ident">index_parent</span>(<span class="ident">index</span>) ) {
	    <span class="type">E</span> <span class="ident">moving_val</span> = <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">index_parent</span>(<span class="ident">index</span>)) ;
            <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">index</span>, <span class="ident">moving_val</span>) ;
	}

        <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">index</span>, <span class="ident">x</span>) ;
    }

    <span class="comment">/**
     * Internal method to percolate down in the heap.
     * @param index the index at which the percolate begins.
     */</span>
    <span class="kw">private</span> <span class="kw">void</span> <span class="ident">percolateDown</span>(<span class="kw">int</span> <span class="ident">index</span>) {
	<span class="kw">int</span> <span class="ident">ileft</span> = <span class="ident">index_left</span>(<span class="ident">index</span>) ;
	<span class="kw">int</span> <span class="ident">iright</span> = <span class="ident">ileft</span> + <span class="number">1</span> ;

	<span class="kw">if</span> (<span class="ident">ileft</span> &lt; <span class="kw">this</span>.<span class="ident">currentSize</span>) {
	    <span class="type">E</span> <span class="ident">current</span> = <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">index</span>) ;
	    <span class="type">E</span> <span class="ident">left</span> = <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">ileft</span>) ;
	    <span class="kw">boolean</span> <span class="ident">hasRight</span> = <span class="ident">iright</span> &lt; <span class="kw">this</span>.<span class="ident">currentSize</span> ;
	    <span class="type">E</span> <span class="ident">right</span> = (<span class="ident">hasRight</span>)?<span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">iright</span>):<span class="ident">null</span> ;
	    
	    <span class="kw">if</span> (!<span class="ident">hasRight</span> || <span class="ident">left</span>.<span class="ident">compareTo</span>(<span class="ident">right</span>) &lt; <span class="number">0</span>) {
		<span class="comment">// Left is smaller
</span>		<span class="kw">if</span> (<span class="ident">left</span>.<span class="ident">compareTo</span>(<span class="ident">current</span>) &lt; <span class="number">0</span>) {
		    <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">index</span>, <span class="ident">left</span>) ;
		    <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">ileft</span>, <span class="ident">current</span>) ;
		    <span class="kw">this</span>.<span class="ident">percolateDown</span>( <span class="ident">ileft</span> ) ;
		}
	    }
	    <span class="kw">else</span> {
		<span class="comment">// Right is smaller
</span>		<span class="kw">if</span> (<span class="ident">right</span>.<span class="ident">compareTo</span>(<span class="ident">current</span>) &lt; <span class="number">0</span>) {
		    <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">index</span>, <span class="ident">right</span>) ;
		    <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="ident">iright</span>, <span class="ident">current</span>) ;
		    <span class="kw">this</span>.<span class="ident">percolateDown</span>( <span class="ident">iright</span> ) ;
		}		
	    }
	}
    }

    <span class="comment">/**
     * Find the smallest item in the heap.
     * @return the smallest item.
     * @throws Exception if empty.
     */</span>
    <span class="kw">public</span> <span class="type">E</span> <span class="ident">findMin</span>( ) {
        <span class="kw">if</span>( <span class="ident">isEmpty</span>() )
            <span class="kw">throw</span> <span class="kw">new</span> <span class="type">RuntimeException</span>( <span class="string">&quot;Empty binary heap&quot;</span> );
        <span class="kw">return</span> <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="number">0</span>);
    }
    
    <span class="comment">/**
     * Remove the smallest item from the heap.
     * @return the smallest item.
     * @throws Exception if empty.
     */</span>
    <span class="kw">public</span> <span class="type">E</span> <span class="ident">deleteMin</span>( ) {
        <span class="type">E</span> <span class="ident">minItem</span> = <span class="ident">findMin</span>( );
	<span class="type">E</span> <span class="ident">lastItem</span> = <span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(--<span class="kw">this</span>.<span class="ident">currentSize</span>) ;
        <span class="kw">this</span>.<span class="ident">arraySet</span>(<span class="number">0</span>, <span class="ident">lastItem</span>) ;
        <span class="kw">this</span>.<span class="ident">percolateDown</span>( <span class="number">0</span> );
        <span class="kw">return</span> <span class="ident">minItem</span>;
    }
    
    <span class="comment">/**
     * Prints the heap
     */</span>
    <span class="kw">public</span> <span class="kw">void</span> <span class="ident">print</span>() {
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;========  HEAP  (size = &quot;</span> + <span class="kw">this</span>.<span class="ident">currentSize</span> + <span class="string">&quot;)  ========&quot;</span>) ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;

	<span class="kw">for</span> (<span class="kw">int</span> <span class="ident">i</span> = <span class="number">0</span> ; <span class="ident">i</span> &lt; <span class="kw">this</span>.<span class="ident">currentSize</span> ; <span class="ident">i</span>++) {
	    <span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="kw">this</span>.<span class="ident">array</span>.<span class="ident">get</span>(<span class="ident">i</span>).<span class="ident">toString</span>()) ;
	}

	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;--------  End of heap  --------&quot;</span>) ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;
    }

    <span class="comment">/**
     * Prints the elements of the heap according to their respective order.
     */</span>
    <span class="kw">public</span> <span class="kw">void</span> <span class="ident">printSorted</span>() {

	<span class="type">BinaryHeap</span>&lt;<span class="type">E</span>&gt; <span class="ident">copy</span> = <span class="kw">new</span> <span class="type">BinaryHeap</span>&lt;<span class="type">E</span>&gt;(<span class="kw">this</span>) ;

	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;========  Sorted HEAP  (size = &quot;</span> + <span class="kw">this</span>.<span class="ident">currentSize</span> + <span class="string">&quot;)  ========&quot;</span>) ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;

	<span class="kw">while</span> (!<span class="ident">copy</span>.<span class="ident">isEmpty</span>()) {
	    <span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="ident">copy</span>.<span class="ident">deleteMin</span>()) ;
	}

	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;--------  End of heap  --------&quot;</span>) ;
	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>() ;
	}


    
    <span class="comment">// Test program : compare with the reference implementation PriorityQueue.
</span>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">void</span> <span class="ident">main</span>(<span class="type">String</span> [] <span class="ident">args</span>) {
        <span class="type">BinaryHeap</span>&lt;<span class="type">Integer</span>&gt; <span class="ident">heap</span> = <span class="kw">new</span> <span class="type">BinaryHeap</span>&lt;<span class="type">Integer</span>&gt;() ;
	<span class="type">PriorityQueue</span>&lt;<span class="type">Integer</span>&gt; <span class="ident">queue</span> = <span class="kw">new</span> <span class="type">PriorityQueue</span>&lt;<span class="type">Integer</span>&gt;() ;

	<span class="kw">int</span> <span class="ident">count</span> = <span class="number">0</span> ;
	<span class="kw">int</span> <span class="ident">blocksize</span> = <span class="number">10000</span> ;

	<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;Interrupt to stop the test.&quot;</span>) ;
	
	<span class="kw">while</span> (<span class="ident">true</span>) {

	    <span class="comment">// Insert up to blocksize elements
</span>	    <span class="kw">int</span> <span class="ident">nb_insert</span> = (<span class="kw">int</span>)(<span class="type">Math</span>.<span class="ident">random</span>() * (<span class="ident">blocksize</span> + <span class="number">1</span>)) ;
	    
	    <span class="kw">for</span> (<span class="kw">int</span> <span class="ident">i</span> = <span class="number">0</span> ; <span class="ident">i</span> &lt; <span class="ident">nb_insert</span> ; <span class="ident">i</span>++) {
		<span class="type">Integer</span> <span class="ident">obj</span> = <span class="kw">new</span> <span class="type">Integer</span>(<span class="ident">i</span>) ;
		<span class="ident">heap</span>.<span class="ident">insert</span>(<span class="ident">obj</span>) ;
		<span class="ident">queue</span>.<span class="ident">add</span>(<span class="ident">obj</span>) ;
	    }

	    <span class="comment">// Remove up to blocksize elements
</span>	    <span class="kw">int</span> <span class="ident">nb_remove</span> = (<span class="kw">int</span>)(<span class="type">Math</span>.<span class="ident">random</span>() * <span class="ident">blocksize</span> * <span class="number">1.1</span>) ;
	    
	    <span class="kw">if</span> (<span class="ident">nb_remove</span> &gt; <span class="ident">queue</span>.<span class="ident">size</span>()) {
		<span class="ident">nb_remove</span> = <span class="ident">queue</span>.<span class="ident">size</span>() ;
	    }

	    <span class="kw">for</span> (<span class="kw">int</span> <span class="ident">i</span> = <span class="number">0</span> ; <span class="ident">i</span> &lt; <span class="ident">nb_remove</span> ; <span class="ident">i</span>++) {

		<span class="kw">int</span> <span class="ident">removed1</span> = <span class="ident">queue</span>.<span class="ident">poll</span>().<span class="ident">intValue</span>() ;
		<span class="kw">int</span> <span class="ident">removed2</span> = <span class="ident">heap</span>.<span class="ident">deleteMin</span>().<span class="ident">intValue</span>() ;
		
		<span class="kw">if</span> (<span class="ident">removed1</span> != <span class="ident">removed2</span>) {
		    <span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;Ouch : expected &quot;</span> + <span class="ident">removed1</span> + <span class="string">&quot;  .. but got &quot;</span> + <span class="ident">removed2</span>) ;
		    <span class="type">System</span>.<span class="ident">exit</span>(<span class="number">1</span>) ;
		}
	    }

	    <span class="kw">if</span> (<span class="ident">heap</span>.<span class="ident">size</span>() != <span class="ident">queue</span>.<span class="ident">size</span>()) {
		    <span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;Ouch : heap size = &quot;</span> + <span class="ident">heap</span>.<span class="ident">size</span>() + <span class="string">&quot;  queue size = &quot;</span> + <span class="ident">queue</span>.<span class="ident">size</span>() ) ;
		    <span class="type">System</span>.<span class="ident">exit</span>(<span class="number">1</span>) ;
		}

	    <span class="ident">count</span> += <span class="ident">nb_remove</span> ;
	    
	    <span class="kw">if</span> (<span class="ident">count</span> &gt; <span class="number">1000000</span>) {
		<span class="type">System</span>.<span class="ident">out</span>.<span class="ident">println</span>(<span class="string">&quot;&quot;</span> + <span class="ident">count</span> + <span class="string">&quot; items successfully compared. Heap size : &quot;</span> + <span class="ident">heap</span>.<span class="ident">size</span>()) ;
		<span class="ident">count</span> = <span class="number">0</span> ;
	    }
	}
    }
}
</pre></div></div><div class="footer"><a href="http://validator.w3.org/check/referer"><img alt="Validate HTML 1.1" src="../../../Images/xhtml11.gif" /></a><a href="http://jigsaw.w3.org/css-validator/check/referer"><img alt="Validate CSS 2" src="../../../Images/css2.gif" /></a><a class="version" href="../../../version.html">[Informations de version]</a></div><img class="invisible" alt="" src="../../../Images/up.gif" /><img class="invisible" alt="" src="../../../Images/down.gif" /><img class="invisible" alt="" src="../../../Images/right.gif" /></div></body></html>